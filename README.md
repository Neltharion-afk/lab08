# Лабораторная работа: Настройка DHCPv4 и DHCP-ретрансляции

**Цель работы:**  
Освоить настройку DHCP-сервера на маршрутизаторе Cisco, организацию маршрутизации между VLAN, статическую маршрутизацию и DHCP-ретрансляцию (DHCP relay) в соответствии с заданным сценарием.

## Топология сети

<img width="358" height="280" alt="image" src="https://github.com/user-attachments/assets/2c051ef0-808d-4463-868e-7f7734f64e7d" />

## Таблица адресации

| Устройство | Интерфейс | IP-адрес | Маска подсети | Шлюз по умолчанию |
|------------|-----------|----------|----------------|-------------------|
| R1 | G0/0/0 | 10.0.0.1 | 255.255.255.252 | — |
| R1 | G0/0/1.100 | 192.168.1.1 | 255.255.255.192 | — |
| R1 | G0/0/1.200 | 192.168.1.65 | 255.255.255.224 | — |
| R1 | G0/0/1.1000 | — | — | — |
| R2 | G0/0/0 | 10.0.0.2 | 255.255.255.252 | — |
| R2 | G0/0/1 | 192.168.1.97 | 255.255.255.240 | — |
| S1 | VLAN 200 | 192.168.1.66 | 255.255.255.224 | 192.168.1.65 |
| S2 | VLAN 1 | 192.168.1.98 | 255.255.255.240 | 192.168.1.97 |
| PC-A | NIC | DHCP | DHCP | DHCP |
| PC-B | NIC | DHCP | DHCP | DHCP |


## Расчёт подсетей

Исходная сеть: 192.168.1.0/24

| Подсеть | Требование | Маска | Адрес сети | Первый IP | Назначение |
|---------|------------|-------|------------|-----------|------------|
| A | 58 хостов | /26 (255.255.255.192) | 192.168.1.0/26 | 192.168.1.1 | Клиенты S1 (PC-A) |
| B | 28 хостов | /27 (255.255.255.224) | 192.168.1.64/27 | 192.168.1.65 | Управление (S1) |
| C | 12 хостов | /28 (255.255.255.240) | 192.168.1.96/28 | 192.168.1.97 | Клиенты S2 (PC-B) |

Подсеть между маршрутизаторами задана как 10.0.0.0/30.

## 1. Базовая настройка

### 1.1 Маршрутизаторы R1 и R2

Пример для R1:

```
hostname R1
no ip domain-lookup
enable secret class
line console 0
password cisco
login
line vty 0 4
password cisco
login
service password-encryption
banner motd #access#
```

Аналогично для R2

### 1.2 Настройка подинтерфейсов на R1

```
interface g0/0/1
no shutdown
interface g0/0/1.100
description Clients_VLAN_100
encapsulation dot1Q 100
ip address 192.168.1.1 255.255.255.192
interface g0/0/1.200
description Management_VLAN_200
encapsulation dot1Q 200
ip address 192.168.1.65 255.255.255.224
interface g0/0/1.1000
description Native_VLAN_1000
encapsulation dot1Q 1000 native
no ip address
```

### 1.3 Настройка интерфейсов R2 и статической маршрутизации

```
interface g0/0/1
ip address 192.168.1.97 255.255.255.240
no shutdown
interface g0/0/0
ip address 10.0.0.2 255.255.255.252
no shutdown
```

### 1.4 Статические маршруты по умолчанию

```
R1: ip route 0.0.0.0 0.0.0.0 10.0.0.2
R2: ip route 0.0.0.0 0.0.0.0 10.0.0.1
```

Проверка:
С R1 выполнен ```ping 192.168.1.97``` (успешно).

<img width="489" height="86" alt="image" src="https://github.com/user-attachments/assets/553a2d61-fae8-4a59-a4ba-a7b747119b7f" />

### 1.5 Настройка коммутаторов S1 и S2

#### 1.5.1 Коммутатор - S1

Создание VLAN:
```
vlan 100
name Clients
vlan 200
name Management
vlan 999
name Parking_Lot
vlan 1000
name Native
```

Интерфейс управления:
```
interface vlan 200
ip address 192.168.1.66 255.255.255.224
no shutdown
ip default-gateway 192.168.1.65
```

Назначение портов:
```
interface f0/6
switchport mode access
switchport access vlan 100
no shutdown
interface range f0/1-4, f0/7-24, g0/1-2
switchport mode access
switchport access vlan 999
shutdown
```

Транковый порт f0/5:
```
interface f0/5
switchport trunk encapsulation dot1q
switchport mode trunk
switchport trunk native vlan 1000
switchport trunk allowed vlan 100,200,1000
no shutdown
```

#### 1.5.2 Коммутатор S2

Интерфейс управления:
```
interface vlan 1
ip address 192.168.1.98 255.255.255.240
no shutdown
ip default-gateway 192.168.1.97
```

Отключение неиспользуемых портов:
```
interface range f0/1-17, f0/19-24, g0/1-2
shutdown
```

Почему интерфейс F0/5 указан в VLAN 1 до настройки транка?
По умолчанию все порты коммутатора находятся в VLAN 1. После перевода порта в режим trunk он выходит из VLAN 1 и начинает пропускать трафик нескольких VLAN согласно конфигурации.

### 1.6 Настройка DHCP-сервера на R1

#### Настройка DHCPv4 на R1

Исключение первых пяти адресов в каждой подсети:
```
ip dhcp excluded-address 192.168.1.1 192.168.1.5
ip dhcp excluded-address 192.168.1.97 192.168.1.101
```


Пул для клиентов A (подсеть 192.168.1.0/26):
```
ip dhcp pool CLIENTS_A
network 192.168.1.0 255.255.255.192
default-router 192.168.1.1
domain-name CCNA-lab.com
```

Пул для клиентов C (подсеть 192.168.1.96/28):
```
ip dhcp pool R2_Client_LAN
network 192.168.1.96 255.255.255.240
default-router 192.168.1.97
domain-name CCNA-lab.com
```

### 1.7 Настройка DHCP relay на R2

На интерфейсе G0/0/1 R2, подключённом к клиентам, указываем адрес DHCP-сервера (R1):
```
interface g0/0/1
ip helper-address 10.0.0.1
```

> **Важное примечание:** В используемой версии Cisco Packet Tracer команда `lease` не поддерживается. Поэтому установка времени аренды 2 дня 12 часов 30 минут невозможна в рамках симулятора. DHCP-сервер работает со значением по умолчанию — 1 день. В реальной операционной системе Cisco IOS команда ```lease 2 12 30``` была бы применена согласно заданию.

## 2. Проверка работы DHCP

### 2.1 Проверка DHCP на PC-A

Проверка получения IP-адреса на PC-A

<img width="654" height="165" alt="image" src="https://github.com/user-attachments/assets/4d7f78fd-6b13-440b-8867-fae3dbadb01c" />

Пинг до шлюза (192.168.1.1):

<img width="396" height="186" alt="image" src="https://github.com/user-attachments/assets/b52d6bf4-3c13-4fe7-891f-b16ba091f0ab" />

### 2.2 Проверка DHCP на PC-B

Проверка получения IP-адреса на PC-B:

<img width="655" height="159" alt="image" src="https://github.com/user-attachments/assets/8526b40c-04d5-432d-82ea-fc4b807f2f56" />

Пинг до интерфейса R1 G0/0/1 (192.168.1.1):

<img width="404" height="183" alt="image" src="https://github.com/user-attachments/assets/00deabba-1c3a-4f25-86c0-22fc7f32fdf7" />

### 2.3 Статистика DHCP-сервера

Команда ```show ip dhcp binding``` показывает назначенные адреса:

<img width="592" height="69" alt="image" src="https://github.com/user-attachments/assets/a14a4684-aad1-411b-b271-3cd4b1f139d1" />

### 3. Ответы на контрольные вопросы:

1. Почему интерфейс F0/5 указан в VLAN 1?

По умолчанию все порты коммутатора Cisco находятся в VLAN 1 (native VLAN). До настройки транка порт F0/5 работает как обычный access-порт и принадлежит VLAN 1. После перевода порта в режим trunk он выходит из VLAN 1 и начинает пропускать трафик нескольких VLAN согласно конфигурации (в данном случае VLAN 100, 200 и 1000). Таким образом, начальное отображение в VLAN 1 — это стандартное поведение коммутатора до изменения режима порта.

2. Какой IP-адрес получил бы ПК, если бы он был подключён к сети с помощью DHCP до настройки сервера?

Если DHCP-сервер не настроен или недоступен, ПК не может получить IP-адрес от DHCP. В операционных системах Windows (и некоторых других) в такой ситуации активируется механизм APIPA (Automatic Private IP Addressing). ПК автоматически назначает себе адрес из диапазона 169.254.0.0/16 (от 169.254.0.1 до 169.254.255.254) с маской подсети 255.255.0.0. Это позволяет устройствам в одной локальной сети связываться друг с другом, но не обеспечивает выход в другие сети или интернет.

### 4. Выводы

В ходе выполнения лабораторной работы были успешно реализованы следующие задачи:

Создана топология сети в Cisco Packet Tracer в соответствии с заданием.

Выполнен расчёт подсетей из диапазона 192.168.1.0/24 для трёх VLAN: подсеть A (/26), подсеть B (/27), подсеть C (/28).

Настроены базовые параметры маршрутизаторов R1 и R2 (имена, пароли, баннер, отключение DNS-поиска).

Настроена маршрутизация между VLAN на R1 с использованием подинтерфейсов (Router-on-a-Stick) для VLAN 100, 200 и 1000.

Настроены интерфейсы R2 и статические маршруты по умолчанию, обеспечивающие связь между R1 и R2.

Проведена базовая настройка коммутаторов S1 и S2, созданы необходимые VLAN, настроены интерфейсы управления и шлюзы по умолчанию.

На S1 настроен транковый порт F0/5 с native VLAN 1000 и разрешёнными VLAN 100, 200, 1000.

На R1 настроен DHCP-сервер с двумя пулами для подсетей A и C, исключены первые пять адресов, задано имя домена, время аренды оставлено по умолчанию (1 день) из-за ограничений симулятора.

На R2 настроена DHCP-ретрансляция (команда ip helper-address) на интерфейсе G0/0/1, что позволило клиентам за R2 получать IP-адреса от сервера на R1.

Выполнена проверка получения IP-адресов на PC-A и PC-B, а также проверка связности (пинги до шлюзов и между устройствами). Все проверки прошли успешно, что подтверждает корректность конфигурации.

В результате выполнения лабораторной работы получены практические навыки настройки DHCP-сервера, маршрутизации между VLAN, статической маршрутизации и DHCP-ретрансляции на оборудовании Cisco. Эти знания необходимы для построения масштабируемых сетей с автоматической выдачей IP-конфигураций.



## Часть 2 про которую я забыл :(

## 5. Настройка IPv6, SLAAC и DHCPv6

### 5.1 План IPv6-адресации

| Подсеть | Назначение | IPv6-префикс | Интерфейс | IPv6-адрес |
|---------|------------|--------------|-----------|------------|
| Между R1 и R2 | Транзитная | 2001:db8:0:1::/64 | R1 G0/0/0 | 2001:db8:0:1::1/64 |
| | | | R2 G0/0/0 | 2001:db8:0:1::2/64 |
| Клиенты A (VLAN 100) | Клиентская сеть S1 | 2001:db8:0:100::/64 | R1 G0/0/1.100 | 2001:db8:0:100::1/64 |
| Клиенты C (S2) | Клиентская сеть S2 | 2001:db8:0:200::/64 | R2 G0/0/1 | 2001:db8:0:200::1/64 |

### 5.2 Настройка IPv6 на маршрутизаторах

**Маршрутизатор R1:**
```
ipv6 unicast-routing
interface g0/0/0
ipv6 address 2001:db8:0:1::1/64
no shutdown
interface g0/0/1.100
ipv6 address 2001:db8:0:100::1/64
ipv6 route ::/0 2001:db8:0:1::2
```

**Маршрутизатор R2:**
```
ipv6 unicast-routing
interface g0/0/0
ipv6 address 2001:db8:0:1::2/64
no shutdown
interface g0/0/1
ipv6 address 2001:db8:0:200::1/64
no shutdown
ipv6 route ::/0 2001:db8:0:1::1
```

### 5.3 Настройка stateless DHCPv6

Для автоматической выдачи DNS-сервера и доменного имени используем stateless DHCPv6.
Особенность: в Cisco Packet Tracer не поддерживается команда ipv6 dhcp relay destination, поэтому ретрансляция DHCPv6 между маршрутизаторами невозможна. Чтобы клиенты за R2 всё же получали DNS, сервер stateless DHCPv6 был развёрнут непосредственно на R2 (локально для сети 2001:db8:0:200::/64). Для клиентов в сети 2001:db8:0:100::/64 сервер работает на R1 (эти клиенты находятся в той же подсети, что и сервер).

Настройка на R1 (для клиентов VLAN 100)
```
ipv6 dhcp pool STATELESS_V100
dns-server 2001:4860:4860::8888
domain-name CCNA-lab.com
```

```
interface g0/0/1.100
ipv6 dhcp server STATELESS_V100
ipv6 nd other-config-flag
```

Настройка на R2 (для клиентов на S2)

```
ipv6 dhcp pool STATELESS_V200
dns-server 2001:4860:4860::8888
domain-name CCNA-lab.com
```

```
interface g0/0/1
ipv6 dhcp server STATELESS_V200
ipv6 nd other-config-flag
```

Флаг ```ipv6 nd other-config-flag``` сообщает клиентам, что дополнительную информацию (DNS, домен) нужно запрашивать через DHCPv6, а адреса формировать самостоятельно через SLAAC.

### 5.4 Проверка работы IPv6 на клиентах

#### PC-A (подключён к S1, VLAN 100)

<img width="555" height="259" alt="image" src="https://github.com/user-attachments/assets/5e0b3f12-f70a-4c69-9cbe-cd2e819c966f" />

- **IPv6-адрес:** ```2001:DB8:0:100:B0DF:A24D:94AB:94AB``` (сгенерирован через SLAAC с использованием временных адресов).
- **DNS-сервер IPv6:** ```2001:4860:4860::8888``` (получен от stateless DHCPv6-сервера на R1).
- **Шлюз по умолчанию IPv6:** ```FE80::201:C7FF:FEC2:7A02``` (link-local адрес R1).

#### PC-B (подключён к S2)

<img width="550" height="256" alt="image" src="https://github.com/user-attachments/assets/76dc20b3-3162-4652-987e-803ec2feb66e" />

- **Pv6-адрес:** ```2001:DB8:0:200:202:4AFF:FEC6:2C84``` — сгенерирован через SLAAC на основе MAC-адреса (EUI-64).
- **DNS-сервер IPv6:** ```2001:4860:4860::8888``` — получен от stateless DHCPv6-сервера на R2 (локально).
- **Шлюз по умолчанию IPv6:** ```FE80::240:BFF:FE68:B102``` — link-local адрес R2.

### 5.5 Проверка связности по IPv6

С PC-A выполнен пинг до шлюза R1: ```ping 2001:db8:0:100::1``` (успешно).

С PC-B выполнен пинг до шлюза R2: ```ping 2001:db8:0:200::1``` (успешно).

Пинг между PC-A и PC-B по IPv6 также проходит, что подтверждает корректную маршрутизацию.

<img width="395" height="183" alt="image" src="https://github.com/user-attachments/assets/72c0772f-1b25-4d5b-9656-95e3749e368d" /> <img width="400" height="182" alt="image" src="https://github.com/user-attachments/assets/9409422d-e829-432c-98bd-d925f0d62ce5" />

### Выводы по IPv6-части

Автоматическое назначение IPv6-адресов через SLAAC успешно работает на обоих клиентах.

Stateless DHCPv6 настроен на каждом маршрутизаторе для своей клиентской сети, что обеспечивает клиентам DNS-сервер и доменное имя.

Из-за отсутствия в Cisco Packet Tracer поддержки DHCPv6-ретрансляции сервер для клиентов за R2 пришлось разместить локально на R2. В реальной сети с relay все клиенты могли бы обслуживаться центральным сервером на R1.

Связность по IPv6 между всеми узлами обеспечена статическими маршрутами.

Таким образом, получены практические навыки настройки DHCPv4, DHCPv6, SLAAC, маршрутизации между VLAN и статической маршрутизации на оборудовании Cisco. Учтены ограничения симулятора Packet Tracer, что отражено в соответствующих примечаниях.
